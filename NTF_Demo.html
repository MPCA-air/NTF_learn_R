<!DOCTYPE html>
<html>
  <head>
    <title>R for Data Analysis | NTFAQ</title>
    <meta charset="utf-8">
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/leaflet/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet/leaflet.js"></script>
    <link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
    <script src="libs/Proj4Leaflet/proj4-compressed.js"></script>
    <script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding/leaflet.js"></script>
    <link rel="stylesheet" href="css\xari_style.css" type="text/css" />
    <link rel="stylesheet" href="css\fade.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# R for Data Analysis | NTFAQ
## <span style="display:block; text-align:center;"><img src="https://pbs.twimg.com/media/DNhps0gUQAAcS55.jpg" width="620"></span>

---


class: inverse

# .bigtext[How can I analyze my data?]

--
&lt;br&gt;
.bump-right[
## ...and not want to throw my computer in the lake?
]

--
&lt;br&gt;
.bump-right[
## ...and be able to show someone what I did?
]

--
&lt;br&gt;
.bump-right[
## ...and have it still make sense 2 years from now?
]

---
class: inverse

# .scary[R training is coming this Fall...]


.fade[.center[
&lt;img src='http://lazerhorse.org/wp-content/uploads/2013/06/Old-Horror-Films-Retro-Film-Posters-The-Brain-Eaters.jpg' width="88%" style="margin-top: -34px;"&gt;
]]



---
class: inverse

# R Camp

.center[
&lt;a href="https://mpca-air.github.io/RCamp/"&gt;
&lt;img src='images/RCamp.png' width="70%" style="margin-top: -20px;"&gt;&lt;/a&gt;
]


---
class: inverse

# Air data methods

.center[
&lt;a href="https://mpca-air.github.io/air-methods/"&gt;
&lt;img src='images/methods_book.png' width="70%" style="margin-top: -20px;"&gt;&lt;/a&gt;
]


---
class: white, center
background-image: url("http://blogs.reed.edu/datablog/files/2015/09/RStudio-Ball.png")
background-position: 50% 50%
background-size: 87%


.lower[.center-text[
# is community sourced
]]


---

&lt;div style="margin-top: -20px;"&gt;
.center[![:scale 72%](images\rladies_map.gif)]
&lt;/div&gt;

.center[ __R is spreading.__]

People all around the world contribute to and maintain R. A main focus is making it friendlier and easier to use. 

Imagine 1,000's of graduate students, non-profits, scientists, and data enthusiasts all working to provide you with tools to help analyze and visualize your data. 




---
class: center, middle


# Top 10 reasons to use R


&lt;br&gt;&lt;br&gt;





---

# 1| Dynamic tools


[![:scale 100%](images/pollution_rose_1.png)](https://air-data.shinyapps.io/Metro_shiny_roses/)


.work[It all started with a [Pollution Rose](https://air-data.shinyapps.io/Metro_shiny_roses/).]


---
class: middle


&lt;div class="note"&gt;

We began learning R and we were no longer at the whims of changing budgets because...

&lt;/div&gt;

&lt;br&gt;&lt;strong&gt;&lt;i&gt;...Drum roll please...&lt;/strong&gt;&lt;/i&gt;&lt;br&gt;





---

# 2| **R is FREE!**

--

__Let's install R.__ [Click here!](https://mpca-air.github.io/NTF_learn_R/00_Install.html)

__You can download R right now. We will wait.__


--

&lt;div class="note"&gt; How does R work?&lt;/div&gt;

--

R lets you perform data analysis like you're writing a recipe for chocolate chip cookies. Once you've written your favorite recipe you can use it over and over again or share it with your favorite collaborators and grandkids. 

.center[![:scale 95%](images\recipe_to_cookie.png)]

---

# A data recipe 

&lt;br&gt;

### __Summarized air data__

.smalltext[
_Servings: 1 to 10_
]

1. Download monitoring data from AQS.

2. Look at a plot of the data.

3. Remove bad data.

4. Make a better plot of the data.

5. Summarize the data.

6. Save the results.



---
class: inverse, center, middle

# 3| There's lots of help

--

![:scale 10%](https://windowsfileviewer.com/images/types/xlsx.png)

.bigtext[We've got Excel data.] 

--
&lt;br&gt;
.bigtext[But how do we get it into R?]

--
&lt;br&gt;&lt;br&gt;
_I don't know._ 

--
&lt;br&gt;&lt;br&gt;
__Let's Google it!__


---

.center[
![:scale 50%](images\google_readxl.png)
]

---

# 4| There's a new package waiting for you


When someone shares their analysis recipe or new tool in R, they wrap everything together into a __package__. Packages in R are like Apps for your phone -- you load them each time you want to do something special.



&lt;img src="https://www.rstudio.com/wp-content/uploads/2017/05/readxl-400x464.png" width="345" align="left" style="margin-right: 40px; margin-top: 10px;"&gt;

&lt;br&gt;

Since this data is stored in an Excel file we can load the __readxl__ package, which gives R the power to read data from Excel. 



```r
install.packages("readxl")
```


```r
library(readxl)
```


```r
data &lt;- read_excel("data.xlsx", sheet = "2014")
```


---

# Package stickers 


__readxl__ is only one of many helpful R packages out there. Here's a sample of our favorites.

We have lots of stickers and you should take some with you. Many are for a variety of R communities.

&lt;img src="https://i.pinimg.com/736x/e6/50/80/e650804e9948b5b8b9c231285a576f1b--gears-stickers.jpg" width="335"  align="left" style="margin-left: 70px; margin-top: 50px;"&gt;


&lt;img src="https://www.rstudio.com/wp-content/uploads/2017/05/readxl-400x464.png" width="120" align="right" style="margin-right: 180px; margin-top: 280px;"&gt;


---

# 5| Read all flavors of data

These packages give R the ability to read data from almost any place it may be stored. R can talk to SQL databases, read data saved from other statistical software, and pull data directly from the internet.

--

### R can talk data with:

- AirNow

--

- AQS

--

- NOAA

--

- Dropbox

--

- FTP sites

--

- SQL databases

--

- **.scary[ZIP files, large text files, air modeling output]**


--

&lt;div style="margin-top: -250px;"&gt;

.center[
&lt;span style="font-size: 30px;"&gt;
__Let's try it!__ <i class="fas  fa-bicycle "></i>
&lt;/span&gt;
]

&lt;/div&gt;


---

# Read Excel file 

First take a gander at the data. It's online [HERE](https://github.com/MPCA-air/NTF_learn_R/raw/master/data/Hourly/AQS_1hr_FondduLac.xlsx).

--
&lt;br&gt;

To load the Excel data into R:

`1.` Download the file.

```r
download.file("https://github.com/MPCA-air/NTF_learn_R/raw/master/data/Hourly/AQS_1hr_FondduLac.xlsx", "AQS_FondduLac.xlsx", mode = "wb")
```

--

`2.` Read the __2014__ tab.

```r
data_2014 &lt;- read_excel("AQS_FondduLac.xlsx", sheet = "2014")
```

--

`3.` Read the __2015__ tab.

```r
data_2015 &lt;- read_excel("AQS_FondduLac.xlsx", sheet = "2015")
```


---

# AirNow | Today's AQI

```r
library(tidyverse)

# Connect to AirNow data site to get current air observations
airnow_link &lt;- paste0("https://s3-us-west-1.amazonaws.com//files.airnowtech.org/airnow/today/HourlyData_",
                       format(Sys.time()-60*75, "%Y%m%d%H", tz = "GMT"), ".dat")
  
# Read a "|" delimited file that has no column names - Thanks EPA!
aqi_now   &lt;- read_delim(airnow_link, "|", col_names = F)
                        
# Add column names as a list
names(aqi_now) &lt;- c("date", "time", "aqsid", "city", "local_time", "parameter", "units", "concentration", "agency")

# Filter to Ozone and PM2.5 results
aqi_now &lt;- filter(aqi_now, parameter %in% c("OZONE", "PM2.5"), aqsid == "270177417")
```


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; city &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; date &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; local_time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; parameter &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; concentration &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; units &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Fond du Lac &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 05/11/18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 15:00:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; OZONE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PPB &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Fond du Lac &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 05/11/18 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 15:00:00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PM2.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; UG/M3 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---

# 6| Any plot for any data

![:scale 66%](https://datasciencedojo.com/wp-content/uploads/12_R-and-GGPLOT2-01-845x321.png)

&lt;br&gt;

The _ggplot2_ package has functions to make almost any plot you can think of. It can also layer plots on top of each other to add multiple elements.


```r
install.packages("ggplot2")
```

__The fun can start now.__ <i class="fas  fa-rocket "></i>


---


 
# A `geom_bar()` plot


```r
library(ggplot2)

#o3_data &lt;- filter(data_2015, Parameter == 44201) 

pm_data &lt;- filter(data_2015, Parameter == 88101) %&gt;% group_by(site_catid) %&gt;% summarize(Conc = mean(Conc, na.rm = T))

ggplot(data = pm_data, aes(x = site_catid, y = Conc)) +
   geom_col() + labs(y = "ug/m3", title = "2014 PM2.5 Concentrations")
```

&lt;img src="NTF_Demo_files/figure-html/unnamed-chunk-12-1.png" width="650px" height="315px" /&gt;


---

# Box plots


```r
pm_data &lt;- filter(data_2015, Parameter == 88101)

ggplot(data = pm_data, aes(x = site_catid, y = Conc, fill = site_catid)) +
  geom_boxplot(show.legend = FALSE) + labs(y = "ug/m3", x = "site", title = "2014 PM2.5 Concentrations") + scale_y_log10()
```

&lt;img src="NTF_Demo_files/figure-html/unnamed-chunk-13-1.png" width="1100px" height="390px" /&gt;



---

# beeswarm


```r
install.packages("ggbeeswarm")
```


```r
library(ggbeeswarm)

ggplot(pm_data, aes(y = site_catid, x = Conc, color = Conc)) + geom_quasirandom(groupOnX = F, alpha = .035, show.legend = FALSE) +   
    labs(title = "PM2.5 Results (ug/m^3)", y = "site", x = "ug/m3") + xlim(0, 60)
```

&lt;img src="NTF_Demo_files/figure-html/unnamed-chunk-15-1.png" width="1130px" height="370px" /&gt;


---

# AQI summary


```r
source("https://raw.githubusercontent.com/dKvale/aqi-watch/master/R/aqi_convert.R")

pm_data &lt;- group_by(pm_data, site_catid, Date) %&gt;% summarize(Conc = mean(Conc, na.rm = T)) %&gt;% mutate(aqi_color = conc2color(Conc, "PM25") %&gt;% factor(levels = c("#DB6B1A", "#FFEE00", "#53BF33"))) %&gt;% arrange(aqi_color)

ggplot(data = pm_data, aes(x = site_catid)) +
   geom_bar(aes(fill = aqi_color), show.legend = F) + scale_fill_manual(values = as.character(unique(pm_data$aqi_color))) + labs(title = "2015 AQI results for PM2.5", y = "Days")
```

&lt;img src="NTF_Demo_files/figure-html/unnamed-chunk-16-1.png" width="800px" height="390px" /&gt;


---

# AQI waffles


```r
library(waffle) #devtools::install_github("hrbrmstr/waffle")

pm_sums &lt;- group_by(pm_data, site_catid, aqi_color) %&gt;% summarize(count = n()) %&gt;% arrange(desc(aqi_color)) %&gt;% ungroup() %&gt;% mutate(aqi_color = forcats::fct_recode(aqi_color, Good = "#53BF33", Moderate = "#FFEE00", `Unhealthy` = "#DB6B1A"))

iron(
waffle(filter(pm_sums, site_catid == "27-017-7417") %&gt;% select(aqi_color, count), rows = 7,  size = 0.5, colors = c("#65B345", "#f2d01a"), title  = "Fond du Lac AQI :: 2015") + theme(legend.position="left", legend.text=element_text(size=24), plot.title=element_text(size=30)),

waffle(filter(pm_sums, site_catid == "27-137-7549") %&gt;% select(aqi_color, count), rows = 7,  size = 0.5, colors = rev(c("#F26522", "#F2D01A", "#65B345")), xlab = "1 square = 1 day", title  = "Duluth AQI :: 2015") +  theme(legend.position="left", legend.text=element_text(size=24), plot.title=element_text(size=30), axis.title.x=element_text(size=22)))
```

![](NTF_Demo_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

# Calendar plot


 

```r
install.packages("openair")
```


```r
library(openair) # openair requires date column to be named "date"
library(lubridate) 

data_fond &lt;- filter(pm_data, site_catid == "27-017-7417", month(Date) &lt; 10) %&gt;% rename(date = Date)

calendarPlot(data_fond, pollutant  = "Conc", statistic  = "mean", year = 2015, 
             annotate   = "value", digits = 0, key.footer = "ug/m3",  par.settings = list(fontsize=list(text=22)),
             main = "2015 PM2.5 Concentrations at Fond du Lac")
```

&lt;img src="NTF_Demo_files/figure-html/unnamed-chunk-20-1.png" width="1200px" /&gt;


---

# Time series
 

```r
filter(pm_data, site_catid == "27-017-7417") %&gt;% group_by(Date) %&gt;% summarize(Conc = median(Conc, na.rm = T)) %&gt;% 
  ggplot(aes(x = as.Date(Date), y = Conc, na.rm = T)) + 
         geom_line(size = 1, color = "tomato", size = 3) + geom_point(alpha = 0.5, size = 5) + geom_smooth() +
         ylab("Concentration (ug/m3)") + xlab("") + ggtitle("PM2.5 at Fond du Lac in 2015") + 
         geom_label(aes(x = as.Date("2015-07-23"), y = 32), fill = "steelblue", 
                    label = "the BIG July Event", size = 10) 
```

![](NTF_Demo_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;


---

# Time series - _split by hour_

```r
library(lubridate)

pm_data &lt;- filter(data_2015, site_catid == "27-017-7417", Parameter == 88101)

ggplot(pm_data, aes(x = Hour, y = Conc)) + geom_point(alpha = 0.2) + geom_smooth() +
         labs(y="Concentration (ug/m3)", x="Hour", title="PM2.5 at Fond du Lac in 2015") +
         facet_wrap(~wday(Date, label = T), ncol = 4) + scale_y_log10()
```

![](NTF_Demo_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;


---

# Time series - _split by weekday_

```r
pm_data %&gt;% mutate(color = ifelse(wday(Date) == 7 &amp; month(Date) == 6, "red", "blue")) %&gt;%
  ggplot(aes(x = wday(Date, label = T), y = Conc)) +
    geom_boxplot(aes(fill = color), outlier.alpha = 0, show.legend = F) + geom_jitter(alpha = 0.2) +
    ylab("Concentration (ug/m3)") + xlab("") + ggtitle("PM2.5 at Fond du Lac in 2015") + 
    facet_wrap(~month(Date, label = T), ncol = 4) + scale_y_log10()
```

![](NTF_Demo_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;


---
class: inverse, middle, center

# `...Chart finale...`

---

# A nature journal



```r
library(ggpomological)

nature_plot &lt;- ggplot(pm_data, aes(x = Date, y = Conc)) +
                 geom_point(aes(color = as.factor(month(Date))), alpha = 0.8) + stat_smooth(geom = "line", color = "#C0C0C0", alpha = 0.7) +
                 scale_color_pomological() + theme_pomological_fancy() + scale_y_log10() +
                 labs(title = "Air monitoring results") + theme(legend.position = "none")

paint_pomological(nature_plot, res = 170, width = 1600, height = 550)
```

&lt;img src="NTF_Demo_files/figure-html/unnamed-chunk-25-1.png" width="2133" height="340px" /&gt;


---

# 7| Read all the rows

What if you have a ** _HUGE_ ** file? 

&lt;br&gt;

&gt; __Good timing!__ 
&gt;
&gt; We just requested MET data from the weather people, and they sent us a text file with over a **1,000,000** rows of data. 
&gt;

&lt;br&gt;

---

# We will open it.

To read a large text file:

--

`1.` Download the file.

```r
url &lt;- "https://github.com/MPCA-air/NTF_learn_R/raw/master/data/BIG_MET_data.zip"

download.file(url, "BIG_MET_data.zip")

# It's stored as a ZIP file
unzip("BIG_MET_data.zip", file = "MET_data_2012-2017.csv")
```


--

`2.` Read the data with __ ` read_csv() ` __.

```r
# Inside the ZIP file is a huge csv text file.
# For this we can run read_csv() from the readr package.
# This package has lots of data reading functions.

library(readr) #install.packages("readr")

big_met &lt;- read_csv("MET_data_2012-2017.csv")
```




---

# Did it work?


### Let's count the rows.

```r
nrow(big_met)
```

```
## [1] 1401457
```

--


```r
head(big_met)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; summary &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; icon &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; precipIntensity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; precipProbability &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; temperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; apparentTemperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; dewPoint &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; humidity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; windSpeed &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; windBearing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; visibility &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; cloudCover &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pressure &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; precipType &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; precipAccumulation &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; site_catid &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2013-09-20 05:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63.95 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 58.59 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.83 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 281 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.92 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1008.50 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-003-1002 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2013-09-20 06:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.88 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.88 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.75 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.93 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 265 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.94 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.02 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1008.76 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-003-1002 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2013-09-20 07:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.98 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.98 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.73 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.32 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 272 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1008.76 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-003-1002 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2013-09-20 08:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.81 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.57 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 262 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1008.97 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-003-1002 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---


# dplyr gives you powerful words

.float-left[
![:scale 85%](https://www.kdnuggets.com/wp-content/uploads/hex-dplyr.jpg)


```r
install.packages("dplyr")
```
]

&lt;br&gt;&lt;br&gt;



__Your analysis toolbox__
key _dplyr_ functions

| Function      | Returns                                             |  
|:--------------|:----------------------------------------------------|  
| `select()`    | select individual columns to drop, keep, or reorder |  
| `arrange()`   | reorder or sort rows by value of a column           |  
| `mutate()`    | Add new columns or update existing columns          | 
| `filter()`    | pick a subset of rows by the value of a column      | 
| `group_by()`  | split data into groups by values in a column        |  
| `summarize()` | calculate a single summary row for the entire table |  

&lt;br&gt;


---

# `glimpse()` the data


```r
library(dplyr)

glimpse(big_met)
```

```
## Observations: 1,401,457
## Variables: 17
## $ time                &lt;dttm&gt; 2013-09-20 05:00:00, 2013-09-20 06:00:00,...
## $ summary             &lt;chr&gt; "Clear", "Clear", "Clear", "Clear", "Clear...
## $ icon                &lt;chr&gt; "clear-night", "clear-night", "clear-night...
## $ precipIntensity     &lt;dbl&gt; 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0....
## $ precipProbability   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, ...
## $ temperature         &lt;dbl&gt; 63.95, 62.88, 60.98, 60.71, 60.42, 58.60, ...
## $ apparentTemperature &lt;dbl&gt; 63.95, 62.88, 60.98, 60.71, 60.42, 58.60, ...
## $ dewPoint            &lt;dbl&gt; 58.59, 54.82, 54.73, 54.68, 54.62, 54.61, ...
## $ humidity            &lt;dbl&gt; 0.83, 0.75, 0.80, 0.81, 0.81, 0.87, 0.89, ...
## $ windSpeed           &lt;dbl&gt; 7.80, 8.93, 8.32, 10.57, 7.19, 7.34, 7.29,...
## $ windBearing         &lt;int&gt; 281, 265, 272, 262, 264, 255, 254, 245, 26...
## $ visibility          &lt;dbl&gt; 9.92, 9.94, 10.00, 10.00, 10.00, 10.00, 10...
## $ cloudCover          &lt;dbl&gt; 0.00, 0.02, 0.00, 0.00, 0.00, 0.00, 0.00, ...
## $ pressure            &lt;dbl&gt; 1008.50, 1008.76, 1008.76, 1008.97, 1009.1...
## $ precipType          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "r...
## $ precipAccumulation  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ site_catid          &lt;chr&gt; "27-003-1002", "27-003-1002", "27-003-1002...
```

&lt;br&gt;

---

# `summary()` of all columns


```r
summary(big_met)
```

```
##       time                       summary              icon          
##  Min.   :2011-12-31 07:00:00   Length:1401457     Length:1401457    
##  1st Qu.:2013-04-30 21:00:00   Class :character   Class :character  
##  Median :2014-08-30 12:00:00   Mode  :character   Mode  :character  
##  Mean   :2014-09-10 09:28:39                                        
##  3rd Qu.:2016-01-02 21:00:00                                        
##  Max.   :2018-01-01 05:00:00                                        
##                                                                     
##  precipIntensity   precipProbability  temperature     apparentTemperature
##  Min.   :0.00000   Min.   :0.00000   Min.   :-37.14   Min.   :-56.83     
##  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.: 28.13   1st Qu.: 20.73     
##  Median :0.00000   Median :0.00000   Median : 45.97   Median : 42.39     
##  Mean   :0.00212   Mean   :0.04188   Mean   : 44.31   Mean   : 40.24     
##  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.: 63.53   3rd Qu.: 63.57     
##  Max.   :8.51830   Max.   :1.00000   Max.   :103.23   Max.   :110.73     
##  NA's   :143       NA's   :143       NA's   :1        NA's   :1          
##     dewPoint         humidity        windSpeed      windBearing   
##  Min.   :-44.08   Min.   :0.0900   Min.   : 0.00   Min.   :  0.0  
##  1st Qu.: 20.59   1st Qu.:0.6000   1st Qu.: 4.60   1st Qu.:131.0  
##  Median : 35.60   Median :0.7500   Median : 7.18   Median :199.0  
##  Mean   : 34.71   Mean   :0.7159   Mean   : 8.08   Mean   :200.9  
##  3rd Qu.: 53.05   3rd Qu.:0.8500   3rd Qu.:10.68   3rd Qu.:291.0  
##  Max.   : 80.50   Max.   :1.0000   Max.   :48.93   Max.   :359.0  
##  NA's   :30       NA's   :30       NA's   :2137    NA's   :4756   
##    visibility       cloudCover        pressure       precipType       
##  Min.   : 0.010   Min.   :0.00     Min.   : 973.1   Length:1401457    
##  1st Qu.: 9.400   1st Qu.:0.00     1st Qu.:1010.6   Class :character  
##  Median :10.000   Median :0.08     Median :1015.8   Mode  :character  
##  Mean   : 9.077   Mean   :0.22     Mean   :1016.0                     
##  3rd Qu.:10.000   3rd Qu.:0.31     3rd Qu.:1021.1                     
##  Max.   :10.000   Max.   :1.00     Max.   :1054.9                     
##  NA's   :163      NA's   :166379   NA's   :2644                       
##  precipAccumulation  site_catid       
##  Length:1401457     Length:1401457    
##  Class :character   Class :character  
##  Mode  :character   Mode  :character  
##                                       
##                                       
##                                       
## 
```

---

# ` filter() ` to a single site



```r
# The filter() function is in the package dplyr
fond_met &lt;- filter(big_met, site_catid == "27-017-7417")
```


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; summary &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; icon &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; precipIntensity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; precipProbability &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; temperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; apparentTemperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; dewPoint &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; humidity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; windSpeed &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; windBearing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; visibility &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; cloudCover &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pressure &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; precipType &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; precipAccumulation &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; site_catid &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2014-05-06 05:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35.97 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31.01 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 32.02 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.93 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1018.44 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-017-7417 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2014-05-06 06:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35.94 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 31.58 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.58 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.91 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 77 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.04 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1018.52 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-017-7417 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2014-05-06 07:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34.29 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.02 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.98 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.92 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 86 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1018.14 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-017-7417 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2014-05-06 08:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clear-night &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35.71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29.82 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33.51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.92 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.23 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 97 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.08 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1017.80 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-017-7417 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---

# 8| Join related data tables

Since our concentration data has the same format and only the year is changing, we can bind the two tables together with the function `bind_rows()`.

![](https://cdn-images-1.medium.com/max/1600/1*uG1vjoSQj7gMm8craCj2xA.png)



```r
install.packages("lubridate")
```

and it looks like this


```
## # A tibble: 6 x 12
##   StateCode CountyCode SiteNum Latitude Longitude Date               
##       &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;             
## 1        27         17    7417     46.7     -92.5 2015-06-10 00:00:00
## 2        27         17    7417     46.7     -92.5 2015-06-10 00:00:00
## 3        27         17    7417     46.7     -92.5 2015-06-11 00:00:00
## 4        27         17    7417     46.7     -92.5 2015-06-11 00:00:00
## 5        27         17    7417     46.7     -92.5 2015-06-11 00:00:00
## 6        27         17    7417     46.7     -92.5 2015-06-11 00:00:00
## # ... with 6 more variables: Time &lt;dttm&gt;, Hour &lt;dbl&gt;, Parameter &lt;dbl&gt;,
## #   Conc &lt;dbl&gt;, site_catid &lt;chr&gt;, Year &lt;dbl&gt;
```





---

# `dplyr` gives us a variety of joins

A `left_join()` can pull together two tables like this


![](https://mgimond.github.io/ES218/img/left_join.png)




`left_join()` pulls together our weather and concentration data by the __date__ column in each table.


Now our data looks like this
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; StateCode &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CountyCode &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SiteNum &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Latitude &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Longitude &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Date &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Hour &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Parameter &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Conc &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; site_catid &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; summary &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; precipIntensity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; precipProbability &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; temperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; apparentTemperature &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; dewPoint &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; humidity &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; windSpeed &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; windBearing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; visibility &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; cloudCover &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pressure &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; precipType &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; precipAccumulation &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7417 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.71369 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -92.51172 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2015-06-10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 88101 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 27-017-7417 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2015-06-10 22:00:00 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Clear &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 71.51 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.68 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.35 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.78 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 313 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.01 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1009.4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;





---

# Ozone |  Look at correlations with `pairs()`


```r
ozone &lt;- filter(air_met, Parameter == 44201, site_catid == "27-017-7417")

pairs(select(ozone, temperature, windSpeed, Conc, Hour, humidity), col=rgb(0,100,0,25,maxColorValue=255), na.action = na.omit, cex = .8)
```

![](NTF_Demo_files/figure-html/unnamed-chunk-45-1.png)&lt;!-- --&gt;

---

# PM2.5 |  Look at correlations with `pairs()`


```r
pm &lt;- filter(air_met, Parameter == 88101, site_catid == "27-017-7417", Conc &lt; 30)

pairs(select(pm, temperature, windSpeed, Conc, Hour, humidity), col=rgb(90,160,220,30,maxColorValue=255), na.action = na.omit, cex = .8)
```

![](NTF_Demo_files/figure-html/unnamed-chunk-46-1.png)&lt;!-- --&gt;


---

# 9| Documentation and transparency


.indent[
## **To do list**

1. Analyze data
2. ?
3. ??
]

Documentation is hard work and much of my documentation looks like the above list. But in R, I have written each step into a text file script and __voila!__ There's documentation for myself and others.

&lt;div class="tip"&gt;

.pad-right[
You are encouraged to copy and share analyses and charts with others.

It's especially fun to copy yourself from 2 years ago.
]
&lt;/div&gt;



---

# 10| You can't break your data

&lt;div class="quiz"&gt;

.work[
## Pop Quiz, hotshots!  

&lt;br&gt;
&lt;strong&gt;Which of these things have we done?&lt;/strong&gt;&lt;br&gt;
&lt;i&gt;(Hint: It may be more than one of them.)&lt;/i&gt;
]


&lt;input type="radio"&gt; Lost a data file. &lt;br&gt;
&lt;input type="radio"&gt; Accidently replaced a value in Excel with a random letter like 'z'. &lt;br&gt; 
&lt;input type="radio"&gt; Forgotten which file housed the original data. &lt;br&gt; 
&lt;input type="radio"&gt; Saved over something important. &lt;br&gt; 
&lt;input type="radio"&gt; Lost an entire folder of data.  &lt;br&gt;
&lt;input type="radio"&gt; Forgotten which monitoring days I dropped and why. &lt;br&gt;

&lt;/div&gt;


---

# 10| You can't break your data


You will notice that when we're in R, we always use a name for the data and then tell R to do something to the named object.

&lt;br&gt;

It looks like this:


```r
new_data &lt;- read_excel("air-data.csv")
```

&lt;br&gt;

--

R always act on a **copy** of the data.

It isn't changing the original file. So no worries! 




---

# 10| You can't break your data

If you want to create data from scratch, give the value a name. 


Let's make some values for the temperature and this conference.

```r
current_temp &lt;- 70

this_conference &lt;- "NTFAQ"
```

&lt;br&gt;

--

Now when we type the names into the R console it will tell us what is stored there.

Hey R, what's the `current_temp`?


```r
current_temp
```

```
## [1] 70
```


---

# 12|  R gives you a language for data

It's nice to have words. 

 
1. Let's describe going from data in a __wide__ format to data in a __tall__ format as gather().





```r
library(tidyr)

long_met &lt;- big_met %&gt;% gather(Parameter, Result, -time, -summary, -icon, -site_catid)

view(long_met)
```


---

# The reverse is spread().

```r
wide_met &lt;- long_met %&gt;% spread(Parameter, Result)

view(wide_met)
```



---

# 13| Reproducible - _update with new data_


We have data for 2014 and 2015, but the explosion just happened now _(in the year 2016)_. Remember our data is stored in one Excel workbook. Since we wrote this in a script form we can change the date in our `read_excel()` to __2016__.

&lt;br&gt;


```r
#download.file("https://github.com/MPCA-air/NTF_learn_R/raw/master/data/Hourly/AQS_1hr_FondduLac.xlsx", "AQS_Fonddulac.xlsx", mode = "wb")

data_2016 &lt;- read_excel("AQS_Fonddulac.xlsx", sheet = "2016")
```


We changed the _year_ and __BOOM!__  We've got updated data.


---

# Update the charts 

Now we can follow the same steps we used before to bind the tables togehter and create the charts.



```r
air_data &lt;- bind_rows(data_2016, air_data)
```

---

# PM2.5 waffles



```r
pm_data &lt;- filter(data_2016, Parameter == 88101) %&gt;% summarize(Conc = mean(Conc, na.rm = T)) %&gt;% mutate(aqi_color = conc2color(Conc, "PM25") %&gt;% factor(levels = c("#DB6B1A", "#FFEE00", "#53BF33"))) %&gt;% arrange(aqi_color)

pm_sums &lt;- group_by(pm_data, site_catid, aqi_color) %&gt;% summarize(count = n()) %&gt;% arrange(desc(aqi_color)) %&gt;% ungroup() %&gt;% mutate(aqi_color = forcats::fct_recode(aqi_color, Good = "#53BF33", Moderate = "#FFEE00", `Unhealthy` = "#DB6B1A"))
```

```
## Error in grouped_df_impl(data, unname(vars), drop): Column `site_catid` is unknown
```

```r
iron(
waffle(filter(pm_sums, site_catid == "27-017-7417") %&gt;% select(aqi_color, count), rows = 7,  size = 0.5, colors = c("#65B345", "#f2d01a"), title  = "Fond du Lac AQI :: 2015") + theme(legend.position="left", legend.text=element_text(size=15)),

waffle(filter(pm_sums, site_catid == "27-137-7549") %&gt;% select(aqi_color, count), rows = 7,  size = 0.5, colors = rev(c("#F26522", "#F2D01A", "#65B345")), xlab = "1 square = 1 day", title  = "Duluth AQI :: 2015") +  theme(legend.position="left", legend.text=element_text(size=15), title.text=element_text(size=21), axis.title=element_text(size=15)))
```

```
## Error in (function (el, elname) : "title.text" is not a valid theme element name.
```



---

# 14| Make maps and never get lost again

&gt; Where is the Fond du Lac monitor? 

--

Let's take a look.





```r
library(leaflet)

# Reduce the table to a single row for each monitoring site
air_sites &lt;- group_by(air_met, site_catid) %&gt;% slice(1) %&gt;% filter(SiteNum != 7001)

# Quick interactive map
leaflet(data = air_sites) %&gt;%
   addTiles() %&gt;%
   addCircleMarkers(label = ~as.character(SiteNum), 
              labelOptions = labelOptions(noHide = T))
```

&lt;br&gt;

__Go-Go gadget leaflet!__



---

# 14| Make maps and never get lost again

&lt;br&gt;

<div id="htmlwidget-b029beb5fa22a2d1380c" style="width:77%;height:504px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-b029beb5fa22a2d1380c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[46.713694,46.77107,46.81826,46.743657],[-92.511722,-92.11732,-92.08936,-92.165998],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,["7417","7549","7550","7554"],{"interactive":false,"permanent":true,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[46.713694,46.81826],"lng":[-92.511722,-92.08936]}},"evals":[],"jsHooks":[]}</script>

---

# 14| Make maps and never get lost again

#### Let's add where we are right now.



```r
# Label our location
leaflet(data = air_sites) %&gt;% addTiles() %&gt;%
  addCircleMarkers(label = ~as.character(SiteNum), labelOptions = labelOptions(noHide = T)) %&gt;%
  addPopups(-92.48, 46.66, "&lt;a&gt;You are HERE&lt;/a&gt;")
```

<div id="htmlwidget-9fdf203dd8f484785574" style="width:77%;height:370px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-9fdf203dd8f484785574">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[46.713694,46.77107,46.81826,46.743657],[-92.511722,-92.11732,-92.08936,-92.165998],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,["7417","7549","7550","7554"],{"interactive":false,"permanent":true,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPopups","args":[46.66,-92.48,"<a>You are HERE<\/a>",null,null,{"maxWidth":300,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"className":""}]}],"limits":{"lat":[46.66,46.81826],"lng":[-92.511722,-92.08936]}},"evals":[],"jsHooks":[]}</script>


---

# 14| Map weather alerts



.center[
&lt;img src="images/flood_map.png" width="65%", style="margin-top: -10px;"&gt;
]

---

# 14| Map weather alerts

```r
library(tidyverse)
library(weatherAlerts)
library(leaflet)

alerts &lt;- getAlerts("LA") # takes about 20 seconds

severity &lt;- alerts@data$severity

colorMap &lt;- c(Minor    = "green",
              Moderate = "yellow",
              Severe   = "red",
              Extreme  = "magenta",
              Unknown  = "grey")

severityColors &lt;- unname(colorMap[severity])

leaflet() %&gt;%
  addTiles() %&gt;%
  addPolygons(data = alerts, color = "black", fillColor = severityColors, weight = 1, popup = ~paste0("&lt;strong&gt;", event, "&lt;/strong&gt;", "&lt;br&gt;&lt;br&gt;", summary))
```


---

# Return of the roses

Remember the first pollutant rose we looked at? Let's load the Fond du Lac data set into the tool to see if the refinery explosion could have potentially impacted the PM2.5 concentrations.

[Pollution rose for any data](https://air-data.shinyapps.io/pollution-roses/)


---

# 15| Online community + Us + You


.bigtext[**Join the R community**]

.float-left[
![:scale 93%](https://pbs.twimg.com/profile_images/611535712710729728/ZrqMrN21_400x400.jpg)
]

.float-right[

- #### `#rstats` Twitter
- #### Local R User groups
- #### Online courses and blogs: Coursera, Data Camp, Kaggle
- #### R conferences _(all types of data)_
- #### RLadies Global

.center[
![:scale 90%](https://k-roz.com/img/rladies-dashboard.png)
]

]


---

# 16| It will compliment you

There are some _just for fun_ R packages. 



_cowsay_ outputs a variety of animals saying the quotes of your choice.


```r
library(cowsay)
say("Meowww. You deserve a break.", "cat")
```

```
## 
##  -------------- 
## Meowww. You deserve a break. 
##  --------------
##     \
##       \
##         \
##             |\___/|
##           ==) ^Y^ (==
##             \  ^  /
##              )=*=(
##             /     \
##             |     |
##            /| | | |\
##            \| | |_|/\
##       jgs  //_// ___/
##                \_)
## 
```



---

# Congratulations! 

&lt;img src="https://assets.wired.com/photos/w_2048/wp-content/uploads/2015/02/catinbox_simba_by-jacme31.jpg" width="61%" align="right" style="margin-left: 35px; max-width: 64%" /&gt;

You've completed the Super fast R Intro and are ready for Day 1 of R Camp. 

In the mean time you can find help on _R-Bloggers_, download the learning package _swirl_, or try this [Coursera](https://www.coursera.org/specializations/jhu-data-science) course.


There's even an R intro for __pirates__. If you are a pirate, you can sail the high seas [here](http://tryr.codeschool.com/).

We want to meet you. Come talk to us. Send us an e-mail. 

We are  [Kristie.Ellickson@state.mn.us]() and [Dorian.Kvale@state.mn.us]()

We like __R__. We aren't computer scientists and you don't need to be either.


---

# Back to GitHub

&lt;br&gt;&lt;hr&gt;&lt;br&gt;&lt;br&gt;

Return to the project's [GitHub page](https://github.com/MPCA-air/NTF_learn_R).

This presentation was made with `Rmarkdown` and Yihui's ` xaringan ` package. 





&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;hr&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="css/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "15:9",
"slideNumberFormat": "",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
